"use strict";
var ShoppingCart = function () {
    function t(t, n) {
        void 0 == n ? n = "" : n += ": ", console.log(n + JSON.stringify(t, null, 4))
    }
    function n(t) {
        function n(t, n, i, e, r) {
            return w(d, "id", t).info ? !1 : (d.push({ id: t, name: void 0 !== n ? n : "", quantity: void 0 !== i ? parseInt(i) : 0, price: void 0 !== e ? e : 0, buyer_note: void 0 !== r ? r : "", addon: [] }), !0)
        }
        function i(t, n, i) {
            var e = w(d, "id", t), r = e.info, a = e.index; return r[n] = "quantity" == n ? parseInt(i) : i, d[a] = r, !0
        }
        function e(t) {
            var n = w(d, "id", t), i = n.index; return d.splice(i, 1), !0
        }
        function r(t, n, i, e, r, a) {
            var o = w(d, "id", t), u = o.info, c = o.index;
            return w(u.addon, "id", n).info ? !1 : (u.addon.push({ id: n, name: void 0 !== i ? i : "", quantity: void 0 !== e ? parseInt(e) : 0, price: void 0 !== r ? r : 0, buyer_note: void 0 !== a ? a : "" }), d[c] = u, !0)
        }
        function a(t, n, i, e) {
            var r = w(d, "id", t), a = r.info, o = r.index, u = w(a.addon, "id", n), c = u.info, s = u.index; return c[i] = "quantity" == i ? parseInt(e) : e, a.addon[s] = c, d[o] = a, !0
        } function o(t, n) { var i = w(d, "id", t), e = i.info, r = i.index, a = w(e.addon, "id", n), o = a.index; return e.addon.splice(o, 1), d[r] = e, !0 } var d = t; return { addVariant: n, updateVariant: i, deleteVariant: e, addAddon: r, updateAddon: a, deleteAddon: o, getList: function() { return d } }
    }
    function i(t, n) {
        $.post(V, { action: "cart", action_type: "track-action", cart_action: t, data: n }, function () { })
    }
    function e(n, i) {
        O = b(); var e = { info: null, index: -1 }; return O ? O.hasOwnProperty(n) ? w(O[n], "id", i) : (O[n] = [], q(O), t({ message: n + " type is added !" }), e) : (O = S, O.hasOwnProperty(n) || (O[n] = []), q(O), e)
    }
    function r(n, r, a, o, d, u) {
        return A(n, L) ? null != e(n, r).info ? (t({ error: "cannot add " + n + " " + r + " because it already exists !" }), !1) : (void 0 === a && (a = ""), void 0 === u && (u = ""), void 0 === o ? !1 : ("product" == n ? O[n].push({ id: r, name: a, price: g(d), quantity: g(o), buyer_note: u, variant_list: [] }) : O[n].push({ id: r, name: a, price: g(d), quantity: g(o), buyer_note: u, product_list: [] }), q(O), m(), i("add-item", { item_type: n, item_id: r, item_name: a, quantity: o, price: d, buyer_note: u }), !0)) : (t({ error: n + " is not allowed type !" }), !1)
    }
    function a(t, n) {
        return e(t, n).info
    }
    function o(t, n) {
        O = b(); for (var e = 0, r = O[t].length; r > e; e++)if (O[t][e].id == n) { O[t].splice(e, 1); break } q(O), m(), i("delete-item", { item_type: t, item_id: n })
    }
    function d(n, r, a, o) {
        if (!A(n, L)) return t({ error: n + " is not allowed type !" }), !1; var d = e(n, r), u = d.info, c = d.index; if (!u) return console.log("Cannot modify non-existent item"), !1; switch (a) { case "quantity": u.quantity = g(o), "product" == n && "0" == u.variant_list[0].id && (u.variant_list[0].quantity = u.quantity); break; case "buyer_note": u.buyer_note = o }return O[n][c] = u, q(O), m(), i("update-item", { item_type: n, item_id: r, content_type: a, new_value: o }), !0
    }
    function u(n, i, a) {
        var o = e(n, i), d = o.info, c = o.index; if (!d) return t({ error: n + " " + i + " does not exist " }), r(n, i, "", 1, 0, ""), u(n, i, a); var s = null, p = -1; switch (n) { case "product": s = o.info, p = o.index; break; case "combo": case "deal": var f = w(d.product_list, "id", a); s = f.info, p = f.index }return { item_info: d, item_index: c, product_info: s, product_index: p }
    }
    function c(t, n, i, e, r) {
        switch (t) {
            case "product": O[t][r] = e; break;
            case "combo":
            case "deal": n.product_list[r] = e, O[t][i] = n
        }q(O), m()
    }
    function s(t, n, i, e, a) {
        return r("product", t, n, i, e, a)
    }
    function p(t, n, i, e, a) {
        return r("combo", t, n, i, e, a)
    }
    function f(t, n, i, e, a) {
        return r("deal", t, n, i, e, a)
    }
    function l(e, r, a, o, d, s, p, f) {
        if (!A(e, L)) return t({ error: e + " is not allowed type !" }), !1; var l = u(e, r, a), _ = l.item_info, v = l.item_index, y = l.product_info, m = l.product_index; y || (y = { id: a, name: "", quantity: 1, price: 0, buyer_note: "", variant_list: [] }, m = _.product_list.length, _.product_list[m] = y); var x = n(y.variant_list); return x.addVariant(o, d, s, p, f) || (x.updateVariant(o, "name", d), x.updateVariant(o, "quantity", s), x.updateVariant(o, "price", p), x.updateVariant(o, "buyer_note", f)), y.variant_list = x.getList(), c(e, _, v, y, m), i("add-variant", { item_type: e, item_id: r, product_id: a, variant_id: o, variant_name: d, quantity: s, price: p, buyer_note: f }), !0
    }
    function _(e, r, a, o) {
        if (!A(e, L)) return t({ error: e + " is not allowed type !" }), !1; var d = u(e, r, a); if (!d) return t({ error: e + " " + r + " does not exist !" }), !1; var s = d.item_info, p = d.item_index, f = d.product_info, l = d.product_index, _ = n(f.variant_list); return _.deleteVariant(o), f.variant_list = _.getList(), c(e, s, p, f, l), i("delete-variant", { item_type: e, item_id: r, product_id: a, variant_id: o }), !0
    }
    function v(i, e, r, a, o, d, s, p, f) {
        if (!A(i, L)) return t({ error: i + " is not allowed type !" }), !1; var l = u(i, e, r); if (!l) return t({ error: i + " " + e + " does not exist !" }), !1; var _ = l.item_info, v = l.item_index, y = l.product_info, m = l.product_index; if (!y) return t({ error: "product " + r + " does not exist !" }), !1; 0 == a && y.variant_list.length < 1 && (y.variant_list = [{ id: 0, name: "", quantity: y.quantity, price: y.price, buyer_note: "", addon: [] }]); var x = n(y.variant_list); return x.addAddon(a, o, d, s, p, f) || (x.updateAddon(a, o, "name", d), x.updateAddon(a, o, "quantity", s), x.updateAddon(a, o, "price", p), x.updateAddon(a, o, "buyer_note", f)), y.variant_list = x.getList(), c(i, _, v, y, m), !0
    }
    function y(i, e, r, a, o) {
        if (!A(i, L)) return t({ error: i + " is not allowed type !" }), !1; var d = u(i, e, r); if (!d) return t({ error: i + " " + e + " does not exist !" }), !1; var s = d.item_info, p = d.item_index, f = d.product_info, l = d.product_index, _ = n(f.variant_list); return _.deleteAddon(a, o), f.variant_list = _.getList(), c(i, s, p, f, l), !0
    }
    function m() {
        function n(t) {
            var n, i = 0; for (n = 0; n < t.length; n++)i += t[n].price * t[n].quantity; return i
        }
        O = b();
        var i, e, r, a = 0, o = 0, d = 0;
        for (var u in O)
            if (O.hasOwnProperty(u))
                for (var c = 0; c < O[u].length; c++)
                    switch (u) {
                    case "product": for (i = O[u][c], i.quantity = g(i.quantity), r = 0; r < i.variant_list.length; r++)e = i.variant_list[r], e.quantity = g(e.quantity), 0 == e.id ? (a += 1, o += i.quantity, d += i.price * i.quantity + n(e.addon)) : (a += 1, o += e.quantity, d += e.price * e.quantity + n(e.addon)); 0 == r && (a += 1, o += i.quantity, d += i.price * i.quantity); break; case "combo": case "deal": a += 1, o += O[u][c].quantity, d += O[u][c].price * O[u][c].quantity; for (var s = 0; s < O[u][c].product_list.length; s++)for (i = O[u][c].product_list[s], r = 0; r < i.variant_list.length; r++)e = i.variant_list[r], d += n(e.addon)
                    }
        return t({item: a, quantity: o, value: d},
            "CartSummary = "),
            t(O, "cart_content = "),
            { item: a, quantity: o, value: d }
    }
    function x() {
        O = S, q(O)
    }
    function h() {
        window.location = C
    }
    function g(t) {
        for (t += ""; t.indexOf(".") > 0;)t = t.replace(".", ""); var n = parseFloat(t); return isNaN(n) ? 0 : n
    }
    function q(t) {
        var n = ""; if (I) { var i = new Date; i.setTime(i.getTime() + 24 * I * 60 * 60 * 1e3), n = "; expires= " + i.toUTCString() } document.cookie = k + "=" + Base64.encode(JSON.stringify(t)) + n + "; path=/;"
    }
    function b() {
        for (var t, n = k + "=", i = document.cookie.split(";"), e = "", r = 0; r < i.length; r++){ for (t = i[r]; " " == t.charAt(0);)t = t.substring(1, t.length); 0 == t.indexOf(n) && (e = t.substring(n.length, t.length)) } try { return "" != e ? JSON.parse(Base64.decode(e)) : null } catch (a) { return console.log("Cart content has been tampered!"), x(), null }
    }
    function w(t, n, i) {
        for (var e = null, r = -1, a = 0, o = t.length; o > a; a++)if (t[a][n] == i) { e = t[a], r = a; break } return { info: e, index: r }
    }
    function A(t, n) {
        return Array.prototype.indexOf || (Array.prototype.indexOf = function(t) { for (var n = 0; n < this.length; n++)if (this[n] === t) return n; return -1 }), -1 !== n.indexOf(t)
    }
    var O, V = "/ajax/post.php", k = "hurastore_shopping_cart", C = "/cart", I = 10, S = { product: [] }, L = ["product", "combo", "deal"];
    return { checkItemExist: a, removeItem: o, updateItem: d, addProduct: s, addCombo: p, addDeal: f, addVariant: l, removeVariant: _, addAddOn: v, removeAddon: y, emptyCart: x, getCartSummary: m, readCart: b, goToCartPage: h }
}();